name: Node-CI-workflow

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    Node-CI:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5
            - uses: actions/setup-node@v5
              with:
                node-version: '22'
            - name: Install dependencies
              run: npm ci   # Creates a clean install of dependencies based on package-lock.json
            - name: Check for voulnerabilities
              run: npm audit --audit-level=high
            - name: Linting
              run: npm run lint
            - name: Run tests
              run: npm run test
            - name: Build project
              run: npm run build

    Render_deployment:
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      needs: Node-CI
      runs-on: ubuntu-latest
      steps:
        - name: Deploy to Render
          env:
            deploy_url: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
          run: |  # With pipeline you can use a multi-line script
              if [ -z "$RENDER_DEPLOY_HOOK_URL" ]; then
                echo "RENDER_DEPLOY_HOOK_URL secret is not set."
                exit 1
              fi
